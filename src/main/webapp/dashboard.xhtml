<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>Admin Dashboard</title>
        <h:outputStylesheet library="css" name="style.css"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </h:head>
    <h:body>
        <f:event type="preRenderView" listener="#{dashboardBean.onPageLoad}"/>
        <div class="container">
            <div class="header">
                <h1>ðŸ“Š Admin Dashboard</h1>
                <p>Manage Students and Admissions</p>
            </div>
            
            <div class="content">
                <h:form>
                    <h:messages globalOnly="true" styleClass="error-message" errorClass="error-message"/>
                    
                    <div style="text-align: right; margin-bottom: 20px;">
                        <h:commandButton value="ðŸ”„ Refresh Data" 
                                       actionListener="#{dashboardBean.onRefreshClick}"
                                       styleClass="btn-primary"
                                       style="padding: 10px 20px; font-size: 1em;"/>
                    </div>
                    
                    <!-- Statistics -->
                    <div class="stats-container">
                        <div class="stat-card">
                            <h3>#{dashboardBean.students != null ? dashboardBean.students.size() : 0}</h3>
                            <p>Total Students</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <h3>#{dashboardBean.admissions != null ? dashboardBean.admissions.size() : 0}</h3>
                            <p>Total Admissions</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <h3>#{dashboardBean.courses != null ? dashboardBean.courses.size() : 0}</h3>
                            <p>Available Courses</p>
                        </div>
                    </div>
                    
                    <!-- Students Table -->
                    <div class="form-container">
                        <h3 style="color: #667eea; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">
                            ðŸ“‹ Registered Students
                        </h3>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Age</th>
                                        <th>Registration Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:forEach items="#{dashboardBean.students}" var="student">
                                        <tr>
                                            <td>#{student.studentId}</td>
                                            <td>#{student.fullName}</td>
                                            <td>#{student.email}</td>
                                            <td>#{student.phone}</td>
                                            <td>#{student.age}</td>
                                            <td>
                                                <h:outputText value="#{student.registrationDate}">
                                                    <f:convertDateTime pattern="MMM dd, yyyy"/>
                                                </h:outputText>
                                            </td>
                                            <td>
                                                <h:commandButton value="Edit" 
                                                               action="#{dashboardBean.editStudent}"
                                                               actionListener="#{dashboardBean.onEditStudentClick}"
                                                               styleClass="btn-small btn-edit">
                                                    <f:setPropertyActionListener target="#{dashboardBean.selectedStudent}" value="#{student}"/>
                                                </h:commandButton>
                                                <h:commandButton value="Delete" 
                                                               onclick="return confirm('Are you sure you want to delete this student?')"
                                                               action="#{dashboardBean.deleteStudent}"
                                                               actionListener="#{dashboardBean.onDeleteStudentClick}"
                                                               styleClass="btn-small btn-delete">
                                                    <f:setPropertyActionListener target="#{dashboardBean.selectedStudent}" value="#{student}"/>
                                                </h:commandButton>
                                            </td>
                                        </tr>
                                    </c:forEach>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Admissions Table -->
                    <div class="form-container" style="margin-top: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">
                            ðŸŽ“ Admission Applications
                        </h3>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>App. Number</th>
                                        <th>Student Name</th>
                                        <th>Course</th>
                                        <th>Application Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:forEach items="#{dashboardBean.admissions}" var="admission">
                                        <tr>
                                            <td>#{admission.applicationNumber}</td>
                                            <td>#{admission.student.fullName}</td>
                                            <td>#{admission.course.courseName}</td>
                                            <td>
                                                <h:outputText value="#{admission.admissionDate}">
                                                    <f:convertDateTime pattern="MMM dd, yyyy"/>
                                                </h:outputText>
                                            </td>
                                            <td>
                                                <span class="badge badge-#{admission.status.toLowerCase()}">
                                                    #{admission.status}
                                                </span>
                                            </td>
                                            <td>
                                                <h:commandButton value="Approve" 
                                                               action="#{dashboardBean.approveAdmission}"
                                                               actionListener="#{dashboardBean.onApproveAdmissionClick}"
                                                               styleClass="btn-small btn-approve"
                                                               rendered="#{admission.status != 'APPROVED'}">
                                                    <f:setPropertyActionListener target="#{dashboardBean.selectedAdmission}" value="#{admission}"/>
                                                </h:commandButton>
                                                <h:commandButton value="Reject" 
                                                               action="#{dashboardBean.rejectAdmission}"
                                                               actionListener="#{dashboardBean.onRejectAdmissionClick}"
                                                               styleClass="btn-small btn-reject"
                                                               rendered="#{admission.status != 'REJECTED'}">
                                                    <f:setPropertyActionListener target="#{dashboardBean.selectedAdmission}" value="#{admission}"/>
                                                </h:commandButton>
                                                <h:commandButton value="Delete" 
                                                               onclick="return confirm('Are you sure you want to delete this admission?')"
                                                               action="#{dashboardBean.deleteAdmission}"
                                                               actionListener="#{dashboardBean.onDeleteAdmissionClick}"
                                                               styleClass="btn-small btn-delete">
                                                    <f:setPropertyActionListener target="#{dashboardBean.selectedAdmission}" value="#{admission}"/>
                                                </h:commandButton>
                                            </td>
                                        </tr>
                                    </c:forEach>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Courses Table -->
                    <div class="form-container" style="margin-top: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">
                            ðŸ“š Available Courses
                        </h3>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Course Code</th>
                                        <th>Course Name</th>
                                        <th>Duration</th>
                                        <th>Fee</th>
                                        <th>Available Seats</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:forEach items="#{dashboardBean.courses}" var="course">
                                        <tr>
                                            <td>#{course.courseCode}</td>
                                            <td>#{course.courseName}</td>
                                            <td>#{course.durationYears} years</td>
                                            <td>â‚¹#{course.fee}</td>
                                            <td>#{course.availableSeats}</td>
                                        </tr>
                                    </c:forEach>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </h:form>
            </div>
            
            <div class="navigation">
                <h:link outcome="welcome" value="â† Back to Welcome"/>
                <h:link outcome="register" value="New Registration"/>
                <h:commandLink value="ðŸ”„ Refresh" action="#{dashboardBean.loadData}" style="color: #667eea; text-decoration: none; padding: 10px 20px; border-radius: 5px; transition: all 0.3s;"/>
            </div>
        </div>
    </h:body>
</html>

